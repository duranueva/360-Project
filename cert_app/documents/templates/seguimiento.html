{% extends "base_doc.html" %}

{% block content %}
<div class="space-y-6">

  <!-- Título -->
  <h2 class="text-xl font-semibold text-center">SEGUIMIENTO DE CANDIDATOS</h2>

  <!-- Filtros -->
  <div class="bg-[#D9D9D9] p-6 rounded-md shadow space-y-4 max-w-4xl mx-auto">
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div>
        <label class="block text-sm font-medium">Estandar Competencia:</label>
        <select class="w-full mt-1 px-2 py-1 rounded bg-white border border-gray-300">
          <option>Selecciona</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium">Proyecto:</label>
        <select class="w-full mt-1 px-2 py-1 rounded bg-white border border-gray-300">
          <option>Selecciona</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium">Grupo:</label>
        <select class="w-full mt-1 px-2 py-1 rounded bg-white border border-gray-300">
          <option>Selecciona</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium">Candidato:</label>
        <select class="w-full mt-1 px-2 py-1 rounded bg-white border border-gray-300">
          <option>Selecciona</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Tabla -->
  <div class="overflow-x-auto bg-[#D9D9D9] rounded-md p-4 shadow max-w-7xl mx-auto">
    <table class="min-w-full text-left text-sm text-black">
      <tbody>

        {% for item in candidatos_info %}
          {% with candidato=item.candidato proceso=item.proceso %}
            <!-- Nombre candidato -->
            <thead class="border-b border-gray-400">
              <tr>
                <th colspan="10" class="text-center py-4">{{ candidato.nombre }}</th>
              </tr>
            </thead>

            <!-- EC, Proyecto, Grupo -->
            <tr>
              <td colspan="10" class="text-center py-4">
                EC: x. Proyecto: y. Grupo:
                {% if proceso and proceso.id_grupo %}
                  {{ proceso.id_grupo.nombre }}
                {% else %}
                  Sin grupo
                {% endif %}
              </td>
            </tr>

            <!-- Columnas -->
            <tr>
              <th class="px-4 py-2">Documento</th>
              <th class="px-4 py-2">Realizado</th>
              <th class="px-4 py-2">Acción</th>
            </tr>

            <!-- Correo -->
            <tr class="border-t border-gray-300 hover:bg-gray-200">
              <td class="px-4 py-2">Correo</td>     
              <td class="px-4 py-2">
                {% if candidato.correo %} {{candidato.correo}} ✅ {% else %} ❌ {% endif %}
              </td>
              <td class="px-4 py-2">
                <a class="w-[120px] py-2 bg-[#D9D9D9] hover:bg-[#F5F5F5] flex items-center justify-center rounded-md border border-gray-400 text-center inline-block">
                  Agregar/Modificar
                </a>
                <a href="#"
                  onclick="abrirModalCORREO({{ candidato.id }}, '{{ candidato.correo|default_if_none:"" }}')"
                  class="w-[120px] py-2 bg-[#D9D9D9] hover:bg-[#F5F5F5] flex items-center justify-center rounded-md border border-gray-400 text-center inline-block">
                  Agregar/Modificar - TEST
                </a>
              </td>
            </tr>

            <!-- CURP -->
            <tr class="border-t border-gray-300 hover:bg-gray-200">
              <td class="px-4 py-2">CURP</td>
              <td class="px-4 py-2">
                {% if candidato.curp %} ✅ {% else %} ❌ {% endif %}
              </td>
              <td class="px-4 py-2">
                {% comment %} <a class="w-[120px] py-2 bg-[#D9D9D9] hover:bg-[#F5F5F5] flex items-center justify-center rounded-md border border-gray-400 text-center inline-block">
                  Agregar/Modificar
                </a> {% endcomment %}
                <a href="#"
                  onclick="abrirModalCURP({{ candidato.id }})"
                  class="w-[120px] py-2 bg-[#D9D9D9] hover:bg-[#F5F5F5] flex items-center justify-center rounded-md border border-gray-400 text-center inline-block">
                  Agregar/Modificar
                </a>
              </td>
            </tr>

            <!-- INE -->
            <tr class="border-t border-gray-300 hover:bg-gray-200">
              <td class="px-4 py-2">INE</td>
              <td class="px-4 py-2">
                {% if candidato.ine %} ✅ {% else %} ❌ {% endif %}
              </td>
              <td class="px-4 py-2">
                {% comment %} <a class="w-[120px] py-2 bg-[#D9D9D9] hover:bg-[#F5F5F5] flex items-center justify-center rounded-md border border-gray-400 text-center inline-block">
                  Agregar/Modificar
                </a> {% endcomment %}
                <a href="#" 
                  onclick="abrirModalINE({{ candidato.id }})"
                  class="w-[120px] py-2 bg-[#D9D9D9] hover:bg-[#F5F5F5] flex items-center justify-center rounded-md border border-gray-400 text-center inline-block">
                  Agregar/Modificar
                </a>
                {% if candidato.ine %}
                  <a class="w-[120px] py-2 bg-[#D9D9D9] hover:bg-[#F5F5F5] flex items-center justify-center rounded-md border border-gray-400 text-center inline-block">
                    Ver
                  </a>
                  <a class="w-[120px] py-2 bg-[#D9D9D9] hover:bg-[#F5F5F5] flex items-center justify-center rounded-md border border-gray-400 text-center inline-block">
                    Descargar
                  </a>
                {% endif %}
              </td>
            </tr>

            <!-- Foto -->
            <tr class="border-t border-gray-300 hover:bg-gray-200">
              <td class="px-4 py-2">Foto</td>
              <td class="px-4 py-2">
                {% if candidato.foto %} ✅ {% else %} ❌ {% endif %}
              </td>
              <td class="px-4 py-2">
                {% comment %} <a class="w-[120px] py-2 bg-[#D9D9D9] hover:bg-[#F5F5F5] flex items-center justify-center rounded-md border border-gray-400 text-center inline-block">
                  Agregar/Modificar
                </a> {% endcomment %}
                <a href="#"
                  onclick="abrirModalFOTO({{ candidato.id }})"
                  class="w-[120px] py-2 bg-[#D9D9D9] hover:bg-[#F5F5F5] flex items-center justify-center rounded-md border border-gray-400 text-center inline-block">
                  Agregar/Modificar
                </a>
              </td>
            </tr>

            <!-- Portada (usando InfoProcesoCandidato) -->
            <tr class="border-t border-gray-300 hover:bg-gray-200">
              <td class="px-4 py-2">Portada</td>
              <td class="px-4 py-2">
                {% if proceso and proceso.portada %} ✅ {% else %} ❌ {% endif %}
              </td>
              <td class="px-4 py-2">
                <a class="w-[120px] py-2 bg-[#D9D9D9] hover:bg-[#F5F5F5] flex items-center justify-center rounded-md border border-gray-400 text-center inline-block">
                  Agregar/Modificar
                </a>
              </td>
            </tr>

            <!-- Indice (usando InfoProcesoCandidato) -->
            <tr class="border-t border-gray-300 hover:bg-gray-200">
              <td class="px-4 py-2">Indice</td>
              <td class="px-4 py-2">
                {% if proceso and proceso.indice %} ✅ {% else %} ❌ {% endif %}
              </td>
              <td class="px-4 py-2">
                <a class="w-[120px] py-2 bg-[#D9D9D9] hover:bg-[#F5F5F5] flex items-center justify-center rounded-md border border-gray-400 text-center inline-block">
                  Agregar/Modificar
                </a>
              </td>
            </tr>
            

            <!-- Carta Recepción Documentos (usando InfoProcesoCandidato) -->
            <tr class="border-t border-gray-300 hover:bg-gray-200">
              <td class="px-4 py-2">Carta Recepción Documentos</td>
              <td class="px-4 py-2">
                {% if proceso and proceso.carta_recepcion_docs %} ✅ {% else %} ❌ {% endif %}
              </td>
              <td class="px-4 py-2">
                <a class="w-[120px] py-2 bg-[#D9D9D9] hover:bg-[#F5F5F5] flex items-center justify-center rounded-md border border-gray-400 text-center inline-block">
                  Agregar/Modificar
                </a>
              </td>
            </tr>

            <!-- Reporte de Autenticidad (usando InfoProcesoCandidato) -->
            <tr class="border-t border-gray-300 hover:bg-gray-200">
              <td class="px-4 py-2">Reporte de Autenticidad</td>
              <td class="px-4 py-2">
                {% if proceso and proceso.reporte_autenticidad %} ✅ {% else %} ❌ {% endif %}
              </td>
              <td class="px-4 py-2">
                <a class="w-[120px] py-2 bg-[#D9D9D9] hover:bg-[#F5F5F5] flex items-center justify-center rounded-md border border-gray-400 text-center inline-block">
                  Agregar/Modificar
                </a>
              </td>
            </tr>

            <!-- Triptico de Derechos (usando InfoProcesoCandidato) -->
            <tr class="border-t border-gray-300 hover:bg-gray-200">
              <td class="px-4 py-2">Triptico de Derechos</td>
              <td class="px-4 py-2">
                {% if proceso and proceso.triptico_derechos_img %} ✅ {% else %} ❌ {% endif %}
              </td>
              <td class="px-4 py-2">
                <a class="w-[120px] py-2 bg-[#D9D9D9] hover:bg-[#F5F5F5] flex items-center justify-center rounded-md border border-gray-400 text-center inline-block">
                  Agregar/Modificar
                </a>
              </td>
            </tr>

            <!-- Encuesta de Satisfacción (usando InfoProcesoCandidato) -->
            <tr class="border-t border-gray-300 hover:bg-gray-200">
              <td class="px-4 py-2">Encuesta de Satisfacción</td>
              <td class="px-4 py-2">
                {% if proceso and proceso.encuesta_satisfaccion %} ✅ {% else %} ❌ {% endif %}
              </td>
              <td class="px-4 py-2">
                <a class="w-[120px] py-2 bg-[#D9D9D9] hover:bg-[#F5F5F5] flex items-center justify-center rounded-md border border-gray-400 text-center inline-block">
                  Agregar/Modificar
                </a>
              </td>
            </tr>

            <!-- Cedula de Evaluación (usando InfoProcesoCandidato) -->
            <tr class="border-t border-gray-300 hover:bg-gray-200">
              <td class="px-4 py-2">Cedula de Evaluación</td>
              <td class="px-4 py-2">
                {% if proceso and proceso.cedula_evaluacion %} ✅ {% else %} ❌ {% endif %}
              </td>
              <td class="px-4 py-2">
                <a class="w-[120px] py-2 bg-[#D9D9D9] hover:bg-[#F5F5F5] flex items-center justify-center rounded-md border border-gray-400 text-center inline-block">
                  Agregar/Modificar
                </a>
              </td>
            </tr>

          {% endwith %}
        {% empty %}
          <tr>
            <td colspan="10" class="text-center py-4">No hay candidatos registrados.</td>
          </tr>
        {% endfor %}

      </tbody>
    </table>
  </div>
</div>

<!-- Modal INE -->
<div id="modalINE" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center hidden z-50">
  <div class="bg-[#D9D9D9] p-6 rounded-md shadow max-w-md w-full border border-gray-400">
    <h2 class="text-xl font-semibold text-center mb-4">Subir INE</h2>
    <form id="formINE" method="POST" enctype="multipart/form-data" class="space-y-4">
      {% csrf_token %}
      <div>
        <label class="block text-sm font-medium mb-1">Archivo INE:</label>
        <input type="file" name="ine" required class="w-full px-3 py-2 rounded bg-white border border-gray-300">
      </div>
      <input type="hidden" name="candidato_id" id="candidatoIdINE">
      <div class="flex justify-end gap-4">
        <button type="button" onclick="cerrarModalINE()" class="w-[120px] py-2 bg-[#F5F5F5] hover:bg-gray-300 rounded-md border border-gray-400 text-center">
          Cancelar
        </button>
        <button type="submit" class="w-[120px] py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-center">
          Guardar
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal FOTO -->
<div id="modalFOTO" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center hidden z-50">
  <div class="bg-[#D9D9D9] p-6 rounded-md shadow max-w-md w-full border border-gray-400">
    <h2 class="text-xl font-semibold text-center mb-4">Subir Foto</h2>
    <form id="formFOTO" method="POST" enctype="multipart/form-data" class="space-y-4">
      {% csrf_token %}
      <div>
        <label class="block text-sm font-medium mb-1">Archivo Foto:</label>
        <input type="file" name="foto" required class="w-full px-3 py-2 rounded bg-white border border-gray-300">
      </div>
      <input type="hidden" name="candidato_id" id="candidatoIdFOTO">
      <div class="flex justify-end gap-4">
        <button type="button" onclick="cerrarModalFOTO()" class="w-[120px] py-2 bg-[#F5F5F5] hover:bg-gray-300 rounded-md border border-gray-400 text-center">
          Cancelar
        </button>
        <button type="submit" class="w-[120px] py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-center">
          Guardar
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal CURP -->
<div id="modalCURP" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center hidden z-50">
  <div class="bg-[#D9D9D9] p-6 rounded-md shadow max-w-md w-full border border-gray-400">
    <h2 class="text-xl font-semibold text-center mb-4">Subir CURP</h2>
    <form id="formCURP" method="POST" enctype="multipart/form-data" class="space-y-4">
      {% csrf_token %}
      <div>
        <label class="block text-sm font-medium mb-1">Archivo CURP:</label>
        <input type="file" name="curp" required class="w-full px-3 py-2 rounded bg-white border border-gray-300">
      </div>
      <input type="hidden" name="candidato_id" id="candidatoIdCURP">
      <div class="flex justify-end gap-4">
        <button type="button" onclick="cerrarModalCURP()" class="w-[120px] py-2 bg-[#F5F5F5] hover:bg-gray-300 rounded-md border border-gray-400 text-center">
          Cancelar
        </button>
        <button type="submit" class="w-[120px] py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-center">
          Guardar
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal CORREO -->
<div id="modalCORREO" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center hidden z-50">
  <div class="bg-[#D9D9D9] p-6 rounded-md shadow max-w-md w-full border border-gray-400">
    <h2 class="text-xl font-semibold text-center mb-4">Modificar Correo</h2>
    <form id="formCORREO" method="POST" class="space-y-4">
      {% csrf_token %}
      <div>
        <label class="block text-sm font-medium mb-1">Correo electrónico:</label>
        <input type="email" name="correo" id="correoInput" required class="w-full px-3 py-2 rounded bg-white border border-gray-300">
      </div>
      <input type="hidden" name="candidato_id" id="candidatoIdCORREO">
      <div class="flex justify-end gap-4">
        <button type="button" onclick="cerrarModalCORREO()" class="w-[120px] py-2 bg-[#F5F5F5] hover:bg-gray-300 rounded-md border border-gray-400 text-center">
          Cancelar
        </button>
        <button type="submit" class="w-[120px] py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-center">
          Guardar
        </button>
      </div>
    </form>
  </div>
</div>






<script>
function abrirModalINE(candidatoId) {
  document.getElementById('modalINE').classList.remove('hidden');
  document.getElementById('candidatoIdINE').value = candidatoId;
}

function cerrarModalINE() {
  document.getElementById('modalINE').classList.add('hidden');
}

function abrirModalFOTO(candidatoId) {
  document.getElementById('modalFOTO').classList.remove('hidden');
  document.getElementById('candidatoIdFOTO').value = candidatoId;
}

function cerrarModalFOTO() {
  document.getElementById('modalFOTO').classList.add('hidden');
}

function abrirModalCURP(candidatoId) {
  document.getElementById('modalCURP').classList.remove('hidden');
  document.getElementById('candidatoIdCURP').value = candidatoId;
}

function cerrarModalCURP() {
  document.getElementById('modalCURP').classList.add('hidden');
}

function abrirModalCORREO(candidatoId, correoActual) {
  document.getElementById('modalCORREO').classList.remove('hidden');
  document.getElementById('candidatoIdCORREO').value = candidatoId;
  document.getElementById('correoInput').value = correoActual || '';
}

function cerrarModalCORREO() {
  document.getElementById('modalCORREO').classList.add('hidden');
}



</script>
{% endblock %}


